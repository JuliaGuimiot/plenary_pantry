"""
Pytest configuration for recipe ingestion tests.
"""

import os
import sys
import pytest

# Add the project root to Python path
project_root = os.path.dirname(os.path.dirname(os.path.dirname(__file__)))
if project_root not in sys.path:
    sys.path.insert(0, project_root)

# Also add current directory for pytest
current_dir = os.getcwd()
if current_dir not in sys.path:
    sys.path.insert(0, current_dir)


@pytest.fixture
def test_user():
    """Create a test user for tests"""
    from django.contrib.auth.models import User
    return User.objects.create_user(
        username='testuser',
        email='test@example.com',
        password='testpass123'
    )


@pytest.fixture
def test_ingredients():
    """Create test ingredients and units"""
    from plenary_pantry.models import Ingredient, Unit
    
    ingredients = {
        'flour': Ingredient.objects.create(name="all-purpose flour"),
        'sugar': Ingredient.objects.create(name="granulated sugar"),
        'eggs': Ingredient.objects.create(name="eggs"),
        'butter': Ingredient.objects.create(name="unsalted butter"),
    }
    
    units = {
        'cup': Unit.objects.create(name="cup", abbreviation="cup"),
        'tbsp': Unit.objects.create(name="tablespoon", abbreviation="tbsp"),
        'tsp': Unit.objects.create(name="teaspoon", abbreviation="tsp"),
        'large': Unit.objects.create(name="large", abbreviation="lg"),
    }
    
    return ingredients, units


@pytest.fixture
def sample_recipe_text():
    """Sample recipe text for testing"""
    return """
    Chocolate Chip Cookies
    
    Ingredients:
    2 cups all-purpose flour
    1 cup granulated sugar
    1/2 cup unsalted butter, melted
    2 large eggs
    1 tsp vanilla extract
    1 cup chocolate chips
    
    Instructions:
    1. Preheat oven to 375Â°F.
    2. Mix flour and sugar in a large bowl.
    3. Add melted butter and eggs, mix well.
    4. Stir in vanilla extract and chocolate chips.
    5. Drop rounded tablespoons onto ungreased cookie sheet.
    6. Bake for 9-11 minutes until golden brown.
    
    Prep time: 15 minutes
    Cook time: 10 minutes
    Serves: 24 cookies
    """
