<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Mappings - Plenary Pantry</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #555;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input[type="email"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .mappings-list {
            margin-top: 20px;
        }
        
        .mapping-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f9f9f9;
        }
        
        .mapping-info {
            flex: 1;
        }
        
        .mapping-email {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .mapping-status {
            font-size: 14px;
            color: #666;
        }
        
        .mapping-status.active {
            color: #28a745;
        }
        
        .mapping-status.inactive {
            color: #dc3545;
        }
        
        .mapping-actions {
            display: flex;
            gap: 10px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .info-box h3 {
            color: #0066cc;
            margin-bottom: 10px;
        }
        
        .info-box p {
            color: #333;
            line-height: 1.6;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“§ Email Recipe Ingestion</h1>
        
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        
        <div class="info-box">
            <h3>How Email Recipe Ingestion Works</h3>
            <p>
                Add email addresses below that can send recipe photos to your dedicated recipe email address. 
                When someone sends an email with recipe images to your configured email address, the system will 
                automatically process the attachments and create recipes in your account.
            </p>
        </div>
        
        <div class="section">
            <h2>Add New Email Mapping</h2>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="add">
                <div class="form-group">
                    <label for="email_address">Email Address:</label>
                    <input type="email" id="email_address" name="email_address" 
                           placeholder="friend@example.com" required>
                </div>
                <button type="submit" class="btn">Add Email Mapping</button>
            </form>
        </div>
        
        <div class="section">
            <h2>Your Email Mappings</h2>
            {% if mappings %}
                <div class="mappings-list">
                    {% for mapping in mappings %}
                        <div class="mapping-item">
                            <div class="mapping-info">
                                <div class="mapping-email">{{ mapping.email_address }}</div>
                                <div class="mapping-status {% if mapping.is_active %}active{% else %}inactive{% endif %}">
                                    {% if mapping.is_active %}âœ“ Active{% else %}âœ— Inactive{% endif %}
                                    â€¢ Added {{ mapping.created_at|date:"M d, Y" }}
                                </div>
                            </div>
                            <div class="mapping-actions">
                                <form method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="toggle">
                                    <input type="hidden" name="mapping_id" value="{{ mapping.id }}">
                                    <button type="submit" class="btn btn-sm btn-secondary">
                                        {% if mapping.is_active %}Deactivate{% else %}Activate{% endif %}
                                    </button>
                                </form>
                                <form method="post" style="display: inline;" 
                                      onsubmit="return confirm('Are you sure you want to delete this email mapping?')">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="mapping_id" value="{{ mapping.id }}">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <h3>No Email Mappings</h3>
                    <p>Add email addresses above to allow others to send recipe photos to your account.</p>
                </div>
            {% endif %}
        </div>
        
        <div class="section">
            <h2>Instructions for Senders</h2>
            <div class="info-box">
                <h3>How to Send Recipe Photos</h3>
                <p>
                    <strong>For people with email mappings above:</strong>
                </p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Take photos of recipe cards, cookbook pages, or recipe printouts</li>
                    <li>Send an email to your configured recipe email address</li>
                    <li>Attach the recipe photos to the email</li>
                    <li>The system will automatically process the images and create recipes</li>
                    <li>You'll be able to see the processed recipes in your account</li>
                </ol>
                <p style="margin-top: 15px;">
                    <strong>Supported formats:</strong> JPEG, PNG, GIF, HEIC, HEIF<br>
                    <strong>Maximum file size:</strong> 10MB per attachment<br>
                    <strong>Multiple photos:</strong> You can attach multiple recipe photos in one email
                </p>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <a href="{% url 'ingestion:email_history' %}" class="btn btn-secondary">
                View Email History
            </a>
            <a href="{% url 'ingestion:dashboard' %}" class="btn btn-secondary">
                Back to Dashboard
            </a>
        </div>
    </div>
</body>
</html>
